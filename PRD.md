# Техническое Задание: Разработка GUI-обертки для Figma-export (macOS) - MVP

## 1. Введение

Данный документ описывает требования к разработке графической пользовательской обертки (GUI) для существующего CLI-инструмента `Figma-export` [1]. Инструмент `Figma-export` предназначен для автоматизированного резервного копирования файлов Figma, FigJam и Figma Slides в проприетарном формате `.fig`/`.jam`/`.deck` на локальный диск. Он использует Figma REST API и Playwright для обнаружения и загрузки файлов, а также SQLite3 для управления метаданными и интеллектуального выбора файлов для резервного копирования.

Текущая версия инструмента запускается локально через терминал и настраивается с помощью файла `.env`. **В рамках MVP** целью данной задачи является создание **легковесной GUI-обертки** для macOS, которая будет вызываться через `.command` файл. Эта обертка упростит взаимодействие пользователя с CLI-скриптом, предоставляя интуитивно понятный интерфейс для установки, настройки, запуска и мониторинга, без необходимости прямого взаимодействия с командной строкой.

## 2. Цель проекта (MVP)

Разработать GUI-обертку для macOS на базе Electron, предоставляющую интуитивно понятный интерфейс для установки, настройки, запуска и мониторинга состояния CLI-инструмента `Figma-export`. Обертка будет запускаться через `.command` файл и фокусироваться на базовой функциональности для быстрого развертывания и тестирования основных сценариев использования.

## 3. Требования к разработке

### 3.1. Целевая платформа

*   **Операционная система**: macOS (поддержка последних версий).

### 3.2. Технологический стек

*   **Основная платформа GUI**: Electron.
*   **Фронтенд**: TypeScript (React/Vue/Angular на выбор разработчика, с обоснованием) или другой современный фреймворк для создания пользовательского интерфейса.
*   **Бэкенд (для взаимодействия с CLI)**: Node.js (в рамках Electron).
*   **Языки программирования**: TypeScript (для фронтенда и бэкенда Electron).
*   **Управление зависимостями**: `npm` или `yarn`.

### 3.3. Функциональные требования

Приложение должно обеспечивать следующую функциональность:

#### 3.3.1. Установка CLI-инструмента

*   **Проверка окружения**: GUI должно автоматически проверять наличие необходимых зависимостей: Node.js (рекомендуется v20 LTS) и `npm` (рекомендуется v10 LTS). В случае отсутствия или несоответствия версий, GUI должно автоматически произвести их установку/обновление, уведомляя пользователя о ходе процесса и результате.
*   **Клонирование репозитория**: Автоматическое клонирование репозитория `Figma-export` в заданную пользователем или стандартную директорию.
*   **Установка зависимостей CLI**: После клонирования, GUI должно запустить `npm install` в директории `Figma-export`.

#### 3.3.2. Настройка CLI-инструмента

*   **Управление `.env` файлом**: 
    *   Предоставление удобного интерфейса для ввода и сохранения параметров, таких как `FIGMA_ACCESS_TOKEN`, `FIGMA_ACCOUNT_X_EMAIL`, `FIGMA_ACCOUNT_X_PASSWORD`, `FIGMA_ACCOUNT_X_AUTH_COOKIE`, `DOWNLOAD_PATH`, `WAIT_TIMEOUT`, `MAX_FILES`, `RETRY_DELAY_HOURS`. 
    *   Валидация введенных данных (например, формат токена, пути). 
    *   Возможность добавления/удаления нескольких аккаунтов Figma для ротации.
    *   **В рамках MVP, все настройки хранятся непосредственно в файле `.env`**, без использования Keychain или других механизмов безопасного хранения.

#### 3.3.3. Управление запуском резервного копирования

*   **Генерация `files.json`**: 
    *   Интерфейс для выбора метода генерации `files.json` (по ID команды или по ID проекта).
    *   Поля ввода для `team_ids` и `project_ids` с возможностью добавления нескольких значений.
    *   Запуск соответствующих команд (`npm run get-team-files` или `npm run get-project-files`) и отображение прогресса.
*   **Запуск процесса резервного копирования**: 
    *   Кнопка для запуска команды `npm run start`.
    *   Отображение статуса загрузки каждого файла в реальном времени (на основе вывода CLI).
    *   Возможность остановки процесса резервного копирования (`ctrl+c`).
*   **Повторная попытка неудачных загрузок**: Кнопка для запуска команды `npm run retry`.
*   **Предварительный просмотр (Dry Run)**: Кнопка для запуска `npm run dry-run` и отображения списка файлов, которые будут загружены.

#### 3.3.4. Мониторинг и статистика

*   **Логирование**: Отображение полного вывода CLI-инструмента в удобном, читаемом формате (возможно, с цветовой разметкой для ошибок/предупреждений).
*   **Статус резервного копирования**: Отображение ключевой информации о текущем и предыдущих запусках:
    *   Количество файлов, полученных от Figma API.
    *   Количество файлов, нуждающихся в резервном копировании.
    *   Количество файлов, выбранных для текущего запуска.
    *   Статус отдельных загрузок (успешно/неуспешно).
*   **Отчеты**: Возможность просмотра HTML-отчета о последнем запуске (`npm run report`). Интеграция отчета непосредственно в GUI или открытие его в браузере.
*   **Просмотр базы данных**: Возможность просмотра содержимого `figma_backups.db` через GUI, с фильтрацией и сортировкой данных (например, файлы, никогда не копировавшиеся, измененные с момента последнего копирования, ожидающие повторной попытки). Возможность сброса неудачных загрузок.

#### 3.3.5. Общие требования к GUI

*   **Интуитивно понятный интерфейс**: Простой и понятный дизайн, соответствующий гайдлайнам macOS.
*   **Отзывчивость**: Приложение должно быть отзывчивым и не "зависать" во время выполнения длительных операций CLI.
*   **Уведомления**: Системные уведомления macOS о начале/завершении/ошибках процесса резервного копирования.
*   **Настройки**: Доступ к настройкам `playwright.config.ts` через GUI (например, `fullyParallel`, `workers`, `timeout`), с предупреждением о потенциальных рисках при изменении некоторых параметров.
*   **Обновление скрипта**: Механизм для проверки наличия новых версий `Figma-export` на GitHub и выполнения `git pull` для обновления скрипта.

### 3.4. Нефункциональные требования

*   **Производительность**: Приложение должно быть оптимизировано для минимального потребления системных ресурсов.
*   **Безопасность**: **В рамках MVP, безопасность конфиденциальных данных ограничивается хранением в `.env` файле.** Необходимо информировать пользователя о возможных рисках.
*   **Надежность**: Обработка ошибок и исключений, устойчивость к сбоям CLI-инструмента.
*   **Удобство развертывания**: Приложение должно быть легко устанавливаемым и запускаемым на macOS через `.command` файл.

## 4. Архитектура проекта (предварительная)

Предлагаемая архитектура будет основана на Electron, разделяя приложение на основной процесс (main process) и процесс рендерера (renderer process). Основное отличие в MVP заключается в том, что Electron-приложение будет запускаться не как полноценное standalone приложение, а как обертка, инициируемая через `.command` файл.

### 4.1. Основной процесс (Main Process)

*   **Управление окнами**: Создание и управление окнами приложения.
*   **Взаимодействие с ОС**: Доступ к системным ресурсам (файловая система, уведомления).
*   **Управление дочерними процессами**: Запуск и мониторинг CLI-команд `Figma-export` в отдельных дочерних процессах (`child_process` в Node.js).
*   **API для рендерера**: Предоставление API для взаимодействия процесса рендерера с CLI-инструментом и системными функциями (например, через `ipcMain`).
*   **Логика установки/обновления**: Управление жизненным циклом `Figma-export` (проверка Node.js/npm, клонирование, `npm install`, `git pull`).

### 4.2. Процесс рендерера (Renderer Process)

*   **Пользовательский интерфейс**: Реализация всех элементов GUI с использованием выбранного фронтенд-фреймворка (например, React) и **TypeScript**.
*   **Взаимодействие с основным процессом**: Отправка запросов и получение ответов от основного процесса через `ipcRenderer`.
*   **Отображение данных**: Визуализация статусов, логов, статистики и форм ввода.
*   **Валидация на стороне клиента**: Первичная валидация пользовательского ввода.

### 4.3. Взаимодействие с CLI Figma-export

*   GUI будет взаимодействовать с CLI-инструментом `Figma-export` путем запуска его команд (`npm run <command>`) как дочерних процессов. 
*   Стандартный вывод (stdout) и ошибки (stderr) дочерних процессов будут перехватываться основным процессом Electron и передаваться в процесс рендерера для отображения пользователю.
*   Ввод пользователя (например, для остановки процесса) будет передаваться в дочерние процессы через stdin.

### 4.4. Структура папок (примерная)

```
/FigmaExportGUI
├── run_gui.command (скрипт для запуска Electron-обертки)
├── main.js (основной процесс Electron)
├── package.json
├── /src
│   ├── /renderer (код фронтенда, например, React/Vue с TypeScript)
│   │   ├── App.tsx
│   │   ├── index.tsx
│   │   └── ...
│   ├── /assets (изображения, стили)
│   └── /preload.js (скрипт для безопасного взаимодействия между процессами)
├── /Figma-export (клонированный репозиторий CLI-инструмента)
│   ├── .env
│   ├── figma_backups.db
│   └── ... (оригинальные файлы репозитория)
└── /dist (сборка приложения Electron)
```


## 5. Детальный план реализации (высокоуровневый)

1.  **Инициализация проекта Electron**: Создание базовой структуры проекта Electron, настройка сборки и скриптов запуска, включая `.command` файл для запуска обертки.
2.  **Разработка модуля установки**: 
    *   Реализация проверки наличия Node.js и npm/yarn. Отображение соответствующих инструкций/предложений пользователю.
    *   Логика клонирования репозитория `Figma-export`.
    *   Логика запуска `npm install` для зависимостей CLI-инструмента.
3.  **Разработка модуля настройки**: Создание UI для редактирования `.env` файла. Валидация введенных данных. **Хранение всех настроек в `.env` файле.**
4.  **Интеграция CLI-инструмента**: Разработка механизмов для запуска команд `Figma-export` из основного процесса Electron и перехвата их вывода.
5.  **Разработка модуля управления резервным копированием**: UI для генерации `files.json`, запуска `start`, `retry`, `dry-run`.
6.  **Разработка модуля мониторинга**: UI для отображения логов, статусов и статистики, интеграция HTML-отчетов.
7.  **Разработка модуля настроек CLI**: UI для изменения параметров `playwright.config.ts`.
8.  **Реализация логики обновления**: Механизм для проверки обновлений `Figma-export` на GitHub и выполнения `git pull`.
9.  **Тестирование**: Модульное, интеграционное и системное тестирование всех компонентов приложения.

10. **Документация**: Подготовка пользовательской и технической документации.

## 6. Критические аспекты и риски

*   **Анти-автоматизация Figma**: `Figma-export` уже сталкивается с мерами Figma по борьбе с автоматизацией. GUI должно учитывать это, возможно, предоставляя рекомендации пользователю (например, не снижать `WAIT_TIMEOUT`).
*   **Безопасное хранение учетных данных (MVP)**: В рамках MVP, хранение конфиденциальных данных в `.env` файле представляет риск. Необходимо четко информировать пользователя об этом и, возможно, предусмотреть возможность перехода на более безопасные методы в будущих версиях.
*   **Обработка ошибок CLI**: GUI должно корректно обрабатывать различные ошибки, которые могут возникать в CLI-инструменте, и предоставлять пользователю понятную обратную связь.
*   **Обновления CLI**: Механизм обновления `Figma-export` должен быть надежным и не нарушать текущие настройки пользователя.

## 7. Ожидаемый результат

Легковесная Electron-обертка для macOS, запускаемая через `.command` файл, которая позволяет пользователям без технических знаний командной строки:
*   Устанавливать `Figma-export` с проверкой окружения.
*   Настраивать `Figma-export` через удобный интерфейс, сохраняя параметры в `.env` файле.
*   Управлять параметрами резервного копирования через интуитивно понятный интерфейс.
*   Запускать и останавливать процессы резервного копирования.
*   Мониторить прогресс и просматривать статистику/логи.
*   Обновлять базовый скрипт `Figma-export`.

## 8. Ссылки

[1] Figma-export GitHub Repository: [https://github.com/konstantin-kuzin/Figma-export](https://github.com/konstantin-kuzin/Figma-export)
[2] Electron Security Best Practices: [https://www.electronjs.org/docs/latest/tutorial/security](https://www.electronjs.org/docs/latest/tutorial/security)

